
# TraQuick 开发计划 (更新版)

> **项目名称**：TraQuick (Travel + Quick)  
> **目标平台**：HarmonyOS Next (API 12+)  
> **计划周期**：8 周 (MVP)  
> **最后更新**：2026年2月12日

---

## 📋 项目总览

### 核心目标
构建一款基于 **HarmonyOS Next** 原生的沉浸式旅行社交平台 MVP。核心亮点是 **3D 地球交互引擎** 和 **盲盒社交**，提供“足不出户，探索世界”的独特体验。

### 里程碑状态

| 阶段 | 周期 | 目标 | 状态 | 备注 |
| :--- | :--- | :--- | :--- | :--- |
| **Phase 1** | Week 1-2 | 基础架构与页面还原 | ✅ 已完成 | 核心页面、Mock数据、路由搭建完毕 |
| **Phase 2** | Week 3-4 | 地图引擎与核心交互 | ✅ 已完成 | Map Kit 集成、GeoJSON 区域交互、盲盒 UI 优化完毕 |
| **Phase 3** | Week 5-6 | 社区内容与互动完善 | 🚧 进行中 | 城市详情页优化、发布功能、互动逻辑 |
| **Phase 4** | Week 7 | 后端对接与数据打通 | ⏳ 待开始 | NestJS 服务搭建、API 联调 |
| **Phase 5** | Week 8 | 性能优化与发布准备 | ⏳ 待开始 | 签名上架、真机适配、性能调优 |

---

## ✅ Phase 1: 项目架构与基础页面 (已完成)

### 1.1 核心成果
- [x] **项目脚手架**：基于 API 12 的工程结构，配置签名与权限。
- [x] **设计规范**：建立 `Constants.ets` (颜色、字体、圆角)，统一 UI 风格。
- [x] **数据模型**：定义 User, Post, City, Message 等核心 Interface。
- [x] **页面还原**：完成 Index, Profile, Community, Explore 等 13 个高保真页面。
- [x] **基础组件**：封装 UserAvatar, PostCard 等通用组件。

---

## ✅ Phase 2: 地图引擎与盲盒交互 (已完成)

### 2.1 🌏 Map Kit 深度集成
- [x] **3D 地球**：成功调用 Map Kit 渲染 3D 地球，支持手势旋转缩放。
- [x] **区域交互**：
    - 集成 `GeoJsonParser` 解析全球/中国省市区数据。
    - 实现 `RegionOverlayManager` 状态机：点击省份高亮 → 飞入下钻 → 城市弹窗。
    - 实现国家级区域点击交互（无下钻）。
- [x] **交互优化**：
    - 解决 Map Kit 控件遮挡与点击穿透问题。
    - 优化区域高亮颜色与边框样式。

### 2.2 🎁 盲盒社交 UI 重构
- [x] **漂流瓶 (DriftBottle)**：
    - 重构为海洋主题沉浸式 UI。
    - 实现漂流瓶浮动动画、捡瓶子/投瓶子交互逻辑。
- [x] **时空胶囊 (TimeCapsule)**：
    - 重构为星空主题 UI。
    - 实现埋下胶囊、日期选择、加密锁定状态展示。
- [x] **随机城市弹窗**：
    - 优化 `CityCardDialog` 为半透明磨砂质感，增强视觉吸引力。

### 2.3 ➕ 发布功能交互
- [x] **发布选择器**：优化 `PublishSelectDialog`，实现底部旋转关闭按钮和错峰入场动画。

---

## 🚧 Phase 3: 社区功能与内容完善 (当前重点)

### 3.1 🏙️ 城市详情页深度优化 (进行中)
- [x] **沉浸式背景**：实现抽屉式交互，背景图下拉放大、上滑视差收起。
- [x] **悬浮导航**：实现滑动时顶部导航栏和底部 Tab 栏的悬浮/渐变效果。
- [x] **社区内容复用**：
    - [x] 在城市详情页复用主页社区的 `PostCard` 样式。
    - [x] 实现基于 `cityName` 的动态内容过滤。
    - [x] 增加“视频/社区”子 Tab 切换。
- [x] **图片预览**：修复详情页中点击图片无法放大的问题（已提供方案，待验证）。

### 3.2 📝 内容发布流程完善
- [ ] **图片选择器**：接入系统 `PhotoViewPicker`，支持从相册选择多图。
- [ ] **发布逻辑**：实现发布动态后更新本地 Mock 数据列表（临时）。
- [ ] **输入增强**：支持添加位置标签、话题标签。

### 3.3 👍 互动逻辑闭环
- [ ] **点赞/收藏**：完善状态反转逻辑，确保列表页与详情页状态同步。
- [ ] **评论功能**：完善评论列表展示，支持简单的回复交互（Mock）。

---

## ⏳ Phase 4: 后端对接与数据打通 (计划 Week 7)

### 4.1 后端服务 (NestJS)
- [ ] **环境搭建**：初始化 NestJS + PostgreSQL + TypeORM。
- [ ] **API 开发**：
    - Auth 模块 (登录/注册/Token)。
    - User 模块 (个人信息/关注)。
    - Post 模块 (CRUD/点赞/评论)。
    - City 模块 (城市基础数据/解锁状态)。

### 4.2 前端对接
- [ ] **网络层封装**：完善 `ApiService`，增加拦截器处理 Token 和错误。
- [ ] **数据替换**：逐步将 `MockData` 替换为真实 API 调用。
- [ ] **状态同步**：处理异步数据加载状态 (Loading/Error/Empty)。

---

## ⏳ Phase 5: 性能优化与发布 (计划 Week 8)

### 5.1 性能调优
- [ ] **列表性能**：使用 `LazyForEach` 优化长列表渲染。
- [ ] **地图内存**：优化 GeoJSON 数据加载策略，避免 OOM。
- [ ] **启动速度**：优化首屏加载时间。

### 5.2 鸿蒙特性适配
- [ ] **真机适配**：在 Mate 60/X5 等真机上测试 UI 布局。
- [ ] **深色模式**：检查核心页面的深色模式适配情况。

### 5.3 发布准备
- [ ] **代码清理**：移除无用的资源文件、Mock 代码、Log 日志。
- [ ] **签名打包**：配置发布证书，打包 `.app` 文件。

---

## 📊 进度总结

| 模块 | 完成度  | 状态               |
| :--- |:-----|:-----------------|
| **基础架构** | 100% | ✅ 稳定             |
| **地图引擎** | 95%  | ✅ 核心交互已完成，待性能微调  |
| **盲盒社交** | 90%  | ✅ UI已重构，待接后端     |
| **社区模块** | 90%  |  详情页优化完毕，图片预览已修复 |
| **发布模块** | 60%  | 🚧 UI完成，待接相册选择   |
| **后端服务** | 0%   | ⏳ 待启动            |

**整体进度：约 65%**

---

## 🎯 下一步行动建议

1.  **完善发布**：实现真实的图片选择和发布流程（即使先存本地）。
2.  **准备后端**：如果前端交互已基本满意，可以开始着手后端 API 的设计了。